import{m}from"./alpinejs-830b7ebb-v4.1.3.js";import{t as _}from"./wysiwyg-7a946b6a-v4.1.3.js";import{E as y}from"./Errors-2af62d8a-v4.1.3.js";import{n as b}from"./NProgress-195f2ba2-v4.1.3.js";import"./tinymce-de5c0b61-v4.1.3.js";import"./blueimp-md5-133dffcb-v4.1.3.js";import"./vue-54e7c309-v4.1.3.js";import"./nprogress-c3d60e2c-v4.1.3.js";window.Alpine=m;let n,u;m.data("postEdit",({formData:o={},meta:r={},tags:c=[]})=>({formSubmitting:!1,formSubmissionType:null,form:{...o,featured_image:Array.isArray(o.featured_image)?{}:o.featured_image},errors:new y,init(){this.form.meta={...r.meta_title&&{meta_title:r.meta_title},...r.meta_description&&{meta_description:r.meta_description}},b(),n=this.initTinyMce(),u=this.initTagsSelectize(),u[0].selectize.setValue(c.map(e=>e.id))},initTinyMce(){return _({setup:e=>{e.on("change",()=>{e.save(),e.getElement().dispatchEvent(new Event("input")),this.errors.clear("description")})}})},initTagsSelectize(){return $(".selectize").selectize({plugins:["remove_button"],onChange:e=>{this.form.tags=e}})},focusDescriptionField(){n.get("description").focus()},addFeaturedImage(){new MediaPicker({type:"image"}).on("select",({id:i,path:t})=>{this.form.featured_image={id:+i,path:t}})},removeFeaturedImage(){this.form.featured_image={}},focusFirstErrorField(e){const i=Object.keys(this.errors.errors),t=[...e].find(a=>i.includes(a.name));if(t.classList.contains("wysiwyg")){n.get(t.getAttribute("name")).focus();return}t.focus()},handleSubmit({submissionType:e}){this.formSubmitting=!0,this.formSubmissionType=e;const{id:i,title:t,description:a,slug:l,meta:f,featured_image:d,publish_status:g,blog_category_id:p,tags:h}=this.form;$.ajax({type:"PUT",url:route("admin.blog_posts.update",{id:this.form.id,...e==="save_and_exit"&&{exit_flash:!0}}),data:{id:i,title:t,description:a,slug:l,meta:f,publish_status:g,blog_category_id:p,tags:h,files:{featured_image:d.id?[d.id]:[]}},dataType:"json",success:({message:s})=>{if(e==="save_and_exit"){location.href=route("admin.blog_posts.index");return}success(s)}}).catch(({responseJSON:s})=>{this.errors.reset(),this.errors.record(s.errors),this.focusFirstErrorField(this.$refs.form.elements),error(s.message)}).always(()=>{this.formSubmitting=!1,this.formSubmissionType=null})}}));m.start();
